<!DOCTYPE html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><title>Mengjie's UVI World Engine</title><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/><link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/><style>html,body,#map{height:100%;margin:0;} .panel{position:absolute;left:10px;background:#fff;padding:8px 10px;border:1px solid #ddd;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,0.1);} .panel-title{top:10px;} .panel-search{top:70px;} .panel-color{top:110px;} .panel-date{top:150px;} .panel-time{top:190px;} .panel-legend{top:230px;} .panel-help{top:360px;} .brand{font-size:16px;font-weight:600;color:#111} .by{font-size:12px;color:#444;margin-top:2px} .btn{display:inline-block;padding:4px 8px;border:1px solid #888;border-radius:4px;margin:2px 0;cursor:pointer;} .small{font-size:12px;color:#333} ul{margin:4px 0 0 14px;padding:0;} li{margin:0;padding:0;} input[type=text]{padding:4px 6px;border:1px solid #bbb;border-radius:4px;width:220px} input[type=range]{vertical-align:middle;} select{padding:4px 6px;border:1px solid #bbb;border-radius:4px;} .go{margin-left:6px} .dot{width:14px;height:14px;border-radius:50%;border:2px solid #fff;box-shadow:0 1px 2px rgba(0,0,0,0.4);}</style></head><body><div id='map'></div><div class='panel panel-title'><div class='brand'>Mengjie's UVI World Engine</div><div class='by'>by Mengjie Fan</div></div><div class='panel panel-search small'><input type='text' id='q' placeholder='Search city...'/><span class='btn go' onclick='doSearch()'>Go</span></div><div class='panel panel-color small'>Color by: <label><input type='radio' name='mode' value='uvi' checked> UVI peak</label> <label><input type='radio' name='mode' value='tz'> Timezone</label></div><div class='panel panel-date small'>Date: <select id='dateSel'><option value='latest'>Latest</option></select></div><div class='panel panel-time small'>Time: <input type='range' id='timeSel' min='0' max='23' value='12' oninput='onTimeChange()'> <span id='timeLbl'>12:00</span> <span class='btn' onclick='togglePlay()' id='playBtn'>Play</span></div><div class='panel panel-legend small'><div id='legend-uvi'><b>UVI bands</b><br> <span class='dot' style='background:#32a852'></span> 0–2<br> <span class='dot' style='background:#e0d200'></span> 3–5<br> <span class='dot' style='background:#f1972c'></span> 6–7<br> <span class='dot' style='background:#e64545'></span> 8–10<br> <span class='dot' style='background:#7f3fbf'></span> 11+</div><div id='legend-tz' style='display:none'><b>Timezones</b><br> America <span class='dot' style='background:#1abc9c'></span><br> Europe <span class='dot' style='background:#3498db'></span><br> Africa <span class='dot' style='background:#d35400'></span><br> Asia <span class='dot' style='background:#e91e63'></span><br> Australia <span class='dot' style='background:#16a085'></span><br> Pacific <span class='dot' style='background:#2ecc71'></span><br> Indian <span class='dot' style='background:#e67e22'></span><br> Atlantic <span class='dot' style='background:#9b59b6'></span><br> Other <span class='dot' style='background:#7f8c8d'></span></div></div><div class='panel panel-help small'>Click a city marker to see cached dates and a copyable CLI command.</div><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script><script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script><script>const CITIES = [{"name": "New York, US", "lat": 40.7128, "lon": -74.006, "tz": "America/New_York", "dates": ["2025-08-17"], "latest_date": "2025-08-17", "latest_peak": 7.25, "peaks": {"2025-08-17": 7.586460736012398}, "series": {"2025-08-17": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.14999999999999997, 0.9389987398665631, 2.2606090100109197, 3.8753834876445237, 5.45, 6.487436708024903, 7.122225567336703, 7.171027447973221, 5.8745910335456175, 4.005267403721263, 1.861064684964304, 0.3947602613087959, 0.2310318208865466, 0.0, 0.0, 0.0, 0.0]}, "csvs": {"2025-08-17": "new_york_2025-08-17/uv_minute_40.7128_-74.0060_2025-08-17.csv"}}, {"name": "Los Angeles, US", "lat": 34.0522, "lon": -118.2437, "tz": "America/Los_Angeles", "dates": ["2025-08-17", "2025-08-26"], "latest_date": "2025-08-26", "latest_peak": 10.5, "peaks": {"2025-08-17": 8.455071872554042, "2025-08-26": 30.181452845080077}, "series": {"2025-08-17": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.09999999999999996, 1.0000000000000002, 2.55, 4.4, 6.1, 7.4, 8.05, 8.05, 7.300000000000001, 5.95, 4.199999999999999, 2.4000000000000004, 0.8499999999999999, 0.0, 0.0, 0.0, 0.0], "2025-08-26": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 7.849999999999999, 7.8, 6.999999999999999, 5.65, 3.9, 2.0999999999999996, 0.65, 0.025592222099117264, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}, "csvs": {"2025-08-17": "los_angeles_2025-08-17/uv_minute_34.0522_-118.2437_2025-08-17.csv", "2025-08-26": "uv_minute_34.0522_-118.2437_2025-08-26.csv"}}, {"name": "Chicago, US", "lat": 41.8781, "lon": -87.6298, "tz": "America/Chicago", "dates": ["2025-08-17"], "latest_date": "2025-08-17", "latest_peak": 5.2, "peaks": {"2025-08-17": 5.678020193064196}, "series": {"2025-08-17": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.16122449141236522, 0.8719020715121729, 1.7620762173202176, 2.286711760683587, 3.054873023776977, 3.2804660086546185, 3.904696201656971, 5.23969264044449, 5.247048556712272, 4.141679939287336, 3.1148611172077314, 2.000203727924558, 0.8113833272871067, 0.0, 0.0, 0.0, 0.0]}, "csvs": {"2025-08-17": "chicago_2025-08-17/uv_minute_41.8781_-87.6298_2025-08-17.csv"}}, {"name": "Toronto, CA", "lat": 43.6532, "lon": -79.3832, "tz": "America/Toronto", "dates": ["2025-08-17"], "latest_date": "2025-08-17", "latest_peak": 2.6, "peaks": {"2025-08-17": 3.456867133394134}, "series": {"2025-08-17": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0026753004591227934, 0.04999999999999994, 0.32968663428429784, 0.9739558957417416, 1.52980110747287, 2.0417079509684717, 1.9406044543196446, 1.765678038050349, 2.076222671517484, 2.202422039027859, 2.8676159900956844, 2.6, 1.3, 0.3243488672878509, 0.0, 0.0, 0.0]}, "csvs": {"2025-08-17": "toronto_2025-08-17/uv_minute_43.6532_-79.3832_2025-08-17.csv"}}, {"name": "Mexico City, MX", "lat": 19.4326, "lon": -99.1332, "tz": "America/Mexico_City", "dates": ["2025-08-17"], "latest_date": "2025-08-17", "latest_peak": 9.7, "peaks": {"2025-08-17": 20.999999999999996}, "series": {"2025-08-17": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.14999999999999994, 1.3, 3.3500000000000005, 5.6499999999999995, 7.7, 9.1, 9.674899144791816, 7.625956430684064, 4.238770066124858, 2.051404926119452, 1.2894665151928593, 1.1150600837231923, 0.3499999999999999, 0.0, 0.0, 0.0, 0.0]}, "csvs": {"2025-08-17": "mexico_city_2025-08-17/uv_minute_19.4326_-99.1332_2025-08-17.csv"}}, {"name": "Sao Paulo, BR", "lat": -23.5505, "lon": -46.6333, "tz": "America/Sao_Paulo", "dates": ["2025-08-17"], "latest_date": "2025-08-17", "latest_peak": 6.55, "peaks": {"2025-08-17": 6.908672569190937}, "series": {"2025-08-17": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.049999999999999954, 0.8, 2.35, 4.05, 5.5, 6.3999999999999995, 6.549999999999999, 5.900000000000001, 4.649999999999998, 3.0000000000000004, 1.3, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}, "csvs": {"2025-08-17": "sao_paulo_2025-08-17/uv_minute_-23.5505_-46.6333_2025-08-17.csv"}}, {"name": "Buenos Aires, AR", "lat": -34.6037, "lon": -58.3816, "tz": "America/Argentina/Buenos_Aires", "dates": ["2025-08-17"], "latest_date": "2025-08-17", "latest_peak": 3.75, "peaks": {"2025-08-17": 3.950481559842657}, "series": {"2025-08-17": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.00922577477258388, 0.30222348830658563, 0.9669694014582563, 2.175652599994518, 2.410204254632064, 1.5264574127260198, 2.836394928802621, 3.690178835037369, 2.955707908504965, 1.718897492056453, 0.6000000000000001, 0.0, 0.0, 0.0, 0.0, 0.0]}, "csvs": {"2025-08-17": "buenos_aires_2025-08-17/uv_minute_-34.6037_-58.3816_2025-08-17.csv"}}, {"name": "London, UK", "lat": 51.5074, "lon": -0.1278, "tz": "Europe/London", "dates": ["2025-06-21", "2025-08-17", "2025-09-02"], "latest_date": "2025-09-02", "latest_peak": 3.2, "peaks": {"2025-06-21": 7.3, "2025-08-17": 6.293441026984546, "2025-09-02": 3.0105065244314986}, "series": {"2025-06-21": null, "2025-08-17": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.24999999999999994, 1.0000000000000002, 2.1, 3.35, 4.6, 5.5, 6.05, 6.05, 5.6000000000000005, 4.750000000000001, 3.5499999999999994, 2.2499999999999996, 1.15, 0.2773990347658837, 0.0, 0.0, 0.0], "2025-09-02": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.09999999999999995, 0.6174166095004483, 1.422211975105975, 2.3419289651960775, 2.048648007215484, 1.0029707856808694, 0.9641849426977267, 0.7093419617132043, 0.6986249619452458, 0.6925733111006357, 1.274983728609379, 1.3637497439448294, 0.5025616116149627, 0.0, 0.0, 0.0, 0.0]}, "csvs": {"2025-08-17": "london_2025-08-17/uv_minute_51.5074_-0.1278_2025-08-17.csv", "2025-09-02": "uv_minute_51.5074_-0.1278_2025-09-02.csv"}}, {"name": "Paris, FR", "lat": 48.8566, "lon": 2.3522, "tz": "Europe/Paris", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Berlin, DE", "lat": 52.52, "lon": 13.405, "tz": "Europe/Berlin", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Madrid, ES", "lat": 40.4168, "lon": -3.7038, "tz": "Europe/Madrid", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Rome, IT", "lat": 41.9028, "lon": 12.4964, "tz": "Europe/Rome", "dates": ["2025-08-17"], "latest_date": "2025-08-17", "latest_peak": 7.2, "peaks": {"2025-08-17": 7.2}, "series": {"2025-08-17": null}, "csvs": {}}, {"name": "Palermo, IT", "lat": 38.1157, "lon": 13.3615, "tz": "Europe/Rome", "dates": ["2025-08-17"], "latest_date": "2025-08-17", "latest_peak": 9.7, "peaks": {"2025-08-17": 9.7}, "series": {"2025-08-17": null}, "csvs": {}}, {"name": "Catania, IT", "lat": 37.5079, "lon": 15.083, "tz": "Europe/Rome", "dates": ["2025-08-17"], "latest_date": "2025-08-17", "latest_peak": 10.2, "peaks": {"2025-08-17": 10.2}, "series": {"2025-08-17": null}, "csvs": {}}, {"name": "Istanbul, TR", "lat": 41.0082, "lon": 28.9784, "tz": "Europe/Istanbul", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Dubai, AE", "lat": 25.2048, "lon": 55.2708, "tz": "Asia/Dubai", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Cairo, EG", "lat": 30.0444, "lon": 31.2357, "tz": "Africa/Cairo", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Johannesburg, ZA", "lat": -26.2041, "lon": 28.0473, "tz": "Africa/Johannesburg", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Nairobi, KE", "lat": -1.2921, "lon": 36.8219, "tz": "Africa/Nairobi", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Moscow, RU", "lat": 55.7558, "lon": 37.6173, "tz": "Europe/Moscow", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Tokyo, JP", "lat": 35.6762, "lon": 139.6503, "tz": "Asia/Tokyo", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Shanghai, CN", "lat": 31.2304, "lon": 121.4737, "tz": "Asia/Shanghai", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Singapore, SG", "lat": 1.3521, "lon": 103.8198, "tz": "Asia/Singapore", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Hong Kong, HK", "lat": 22.3193, "lon": 114.1694, "tz": "Asia/Hong_Kong", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Mumbai, IN", "lat": 19.076, "lon": 72.8777, "tz": "Asia/Kolkata", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Sydney, AU", "lat": -33.8688, "lon": 151.2093, "tz": "Australia/Sydney", "dates": ["2025-12-21"], "latest_date": "2025-12-21", "latest_peak": 13.3, "peaks": {"2025-12-21": 13.3}, "series": {"2025-12-21": null}, "csvs": {}}, {"name": "Melbourne, AU", "lat": -37.8136, "lon": 144.9631, "tz": "Australia/Melbourne", "dates": ["2025-09-02"], "latest_date": "2025-09-02", "latest_peak": 4.5, "peaks": {"2025-09-02": 4.9747837659140535}, "series": {"2025-09-02": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.46870088235325646, 1.5760102742505773, 2.183281041759337, 2.604187728608056, 3.043134229756886, 3.573983290513559, 4.07277158790723, 2.568142249501788, 1.7644523979151094, 1.0247517676654176, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}, "csvs": {"2025-09-02": "uv_minute_-37.8136_144.9631_2025-09-02.csv"}}, {"name": "Seoul, KR", "lat": 37.5665, "lon": 126.978, "tz": "Asia/Seoul", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}, {"name": "Beijing, CN", "lat": 39.9042, "lon": 116.4074, "tz": "Asia/Shanghai", "dates": [], "latest_date": null, "latest_peak": null, "peaks": {}, "series": {}, "csvs": {}}];
const DATES = ["2025-06-21", "2025-08-17", "2025-08-26", "2025-09-02", "2025-12-21"];
const map = L.map('map',{worldCopyJump:true}).setView([20,0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom: 8, attribution: '&copy; OpenStreetMap contributors'}).addTo(map);
const cluster = L.markerClusterGroup();
let markers = {};
let MODE = localStorage.getItem('uv_map_mode') || 'uvi';
let SEL_DATE = localStorage.getItem('uv_map_date') || 'latest';
let HOUR = parseInt(localStorage.getItem('uv_map_hour')||'12');
let PLAYING = false, TIMER=null;
const COLORS_UVI=[[0,'#32a852'],[3,'#e0d200'],[6,'#f1972c'],[8,'#e64545'],[11,'#7f3fbf']];
function colorForUvi(val){if(val==null||isNaN(val)) return '#999'; let c='#999'; for(let i=0;i<COLORS_UVI.length;i++){if(val>=COLORS_UVI[i][0]) c=COLORS_UVI[i][1];} return c;}
function colorForTz(tz){const p=(tz||'').split('/')[0].toLowerCase(); const map={america:'#1abc9c',europe:'#3498db',africa:'#d35400',asia:'#e91e63',australia:'#16a085',antarctica:'#95a5a6',atlantic:'#9b59b6',indian:'#e67e22',pacific:'#2ecc71',etc:'#7f8c8d'}; return map[p]||'#7f8c8d';}
function markerIcon(color){return L.divIcon({html:`<div class='dot' style='background:${color}'></div>`,className:''});}
function popupHtml(c){const lat=c.lat.toFixed(4),lon=c.lon.toFixed(4);let h=`<b>${c.name}</b><br><span class=small>${lat}, ${lon} — ${c.tz}</span>`; if(c.latest_peak!=null){h+=`<div class=small>Latest peak UVI: ${c.latest_peak} (${c.latest_date||''})</div>`;} if(c.dates.length){h+=`<div class=small><b>Cached dates:</b><ul>`; c.dates.forEach(d=>{let outCsv=`uv_minute_${lat}_${lon}_${d}.csv`; if(c.csvs && c.csvs[d]) outCsv=c.csvs[d]; const p=c.peaks&&c.peaks[d]!=null?` — peak ${(+c.peaks[d]).toFixed(2)}`:''; h+=`<li>${d}${p} — <a href='${outCsv}' target='_blank'>CSV</a> <span class=btn onclick=copyCmd('${lat}','${lon}','${d}')>Copy CLI</span></li>`}); h+='</ul></div>'; } else { h+=`<div class=small>No cached datasets. <span class=btn onclick=copyCmd('${lat}','${lon}', new Date().toISOString().slice(0,10))>Copy CLI for today</span></div>`;} return h;}
function copyCmd(lat,lon,date){const cmd=`python uv_minute_app.py --lat ${lat} --lon ${lon} --date ${date} --source api --outdir outputs --html`; navigator.clipboard.writeText(cmd).then(()=>{alert('Copied to clipboard:
'+cmd);});}
function buildMarkers(mode,dateSel){cluster.clearLayers(); markers={}; CITIES.forEach(c=>{let val=null; if(mode==='tz'){val=null;} else { if(dateSel==='latest'){val=c.latest_peak;} else { if(c.series && c.series[dateSel]){val=c.series[dateSel][HOUR];} else if(c.peaks && c.peaks[dateSel]!=null){val=c.peaks[dateSel];} } } const color = mode==='tz' ? colorForTz(c.tz) : colorForUvi(val); const m=L.marker([c.lat,c.lon],{icon:markerIcon(color)}); m.bindPopup(popupHtml(c)); m.bindTooltip(c.name); cluster.addLayer(m); markers[c.name.toLowerCase()] = m;}); map.addLayer(cluster);}
function updateTimeUI(){document.getElementById('timeSel').value = HOUR; document.getElementById('timeLbl').textContent = String(HOUR).padStart(2,'0')+':00'; localStorage.setItem('uv_map_hour', String(HOUR));}
function onTimeChange(){HOUR = parseInt(document.getElementById('timeSel').value); updateTimeUI(); buildMarkers(MODE, SEL_DATE);}
function step(){HOUR=(HOUR+1)%24; updateTimeUI(); buildMarkers(MODE, SEL_DATE);}
function togglePlay(){if(PLAYING){clearInterval(TIMER); PLAYING=false; document.getElementById('playBtn').textContent='Play';} else {PLAYING=true; document.getElementById('playBtn').textContent='Pause'; TIMER=setInterval(step, 800);} }
function updateLegend(mode){document.getElementById('legend-uvi').style.display = mode==='uvi' ? 'block' : 'none'; document.getElementById('legend-tz').style.display = mode==='tz' ? 'block' : 'none';}
function initDateOptions(){const sel=document.getElementById('dateSel'); DATES.forEach(d=>{const opt=document.createElement('option'); opt.value=d; opt.textContent=d; sel.appendChild(opt);}); if(SEL_DATE && (SEL_DATE==='latest'||DATES.includes(SEL_DATE))){sel.value=SEL_DATE;} sel.addEventListener('change',()=>{SEL_DATE=sel.value; localStorage.setItem('uv_map_date', SEL_DATE); buildMarkers(MODE, SEL_DATE);});}
function initModeRadio(){const radios=document.querySelectorAll('input[name=\'mode\']'); radios.forEach(r=>{if(r.value===MODE) r.checked=true; r.addEventListener('change',()=>{MODE=r.value; localStorage.setItem('uv_map_mode', MODE); updateLegend(MODE); buildMarkers(MODE, SEL_DATE);});});}
initDateOptions(); updateLegend(MODE); updateTimeUI(); buildMarkers(MODE, SEL_DATE);
document.addEventListener('DOMContentLoaded',()=>{initModeRadio();});
function doSearch(){const q=document.getElementById('q').value.trim().toLowerCase(); if(!q) return; let hit = null; CITIES.forEach(c=>{if(c.name.toLowerCase().includes(q)){hit=c}}); if(hit){const m=markers[hit.name.toLowerCase()]; if(m){map.setView([hit.lat,hit.lon], 6); m.openPopup();}}}
</script></body></html>